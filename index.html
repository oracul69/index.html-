<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Two-Card Multiplier â€” Mini Game</title>
<style>
  :root{
    --bg:#0b0b0b; --text:#f5f5f5; --accent:#25c05a;
    --red:#e53935; --blue:#1e88e5; --muted:#8a8a8a; --trap:#ff3b30;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:760px;margin:0 auto;padding:24px 16px}
  h1{font-size:20px;font-weight:700;margin:0 0 12px}
  .panel{background:#121212;border:1px solid #222;border-radius:14px;padding:16px;margin-bottom:14px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label{font-size:14px;color:#c9c9c9}
  input[type=number]{background:#0f0f0f;color:var(--text);border:1px solid #333;border-radius:10px;padding:10px 12px;width:140px;font-size:16px}
  button{cursor:pointer;border:0;border-radius:12px;padding:12px 16px;font-size:16px;font-weight:700;transition:transform .04s ease,opacity .2s ease}
  button:active{transform:translateY(1px)}
  .btn-start{background:var(--accent);color:#07190e}
  .btn-cash{background:var(--accent);color:#07190e;width:100%;font-size:22px;padding:16px 18px;border-radius:14px}
  .btn-disabled{opacity:.5;pointer-events:none}

  .hud{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;font-variant-numeric:tabular-nums}
  .stat{background:#0f0f0f;border:1px solid #242424;border-radius:12px;padding:10px 12px;min-width:130px}
  .stat .k{display:block;color:#b9b9b9;font-size:12px}
  .stat .v{display:block;font-weight:800;font-size:18px;margin-top:2px}

  .arena{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:14px 0 6px}
  .card{
    position:relative;isolation:isolate;border-radius:16px;aspect-ratio:3/5;
    display:flex;align-items:center;justify-content:center;
    background:#0e0e0e;border:2px dashed #2a2a2a;
    cursor:pointer;user-select:none;
    transition:transform .08s ease,box-shadow .15s ease,border-color .2s ease,background .2s ease;
  }
  .card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.35)}
  .card.revealed{border-style:solid}
  .card.red{--edge:var(--red);border-color:var(--red)}
  .card.blue{--edge:var(--blue);border-color:var(--blue)}

  /* WIN: fully green fill (text remains white) */
  .card.success{
    border-color:var(--accent)!important;
    background:linear-gradient(180deg, rgba(37,192,90,.32), rgba(37,192,90,.18));
    box-shadow:0 0 0 3px rgba(37,192,90,.25),0 12px 32px rgba(0,0,0,.45);
  }
  /* FAIL: fully red fill */
  .card.trap{
    border-color:var(--trap)!important;
    background:linear-gradient(180deg, rgba(255,59,48,.32), rgba(255,59,48,.18));
    box-shadow:0 0 0 3px rgba(255,59,48,.22),0 12px 32px rgba(0,0,0,.45);
  }

  /* Hide ? until reveal so it doesn't overlap cover text */
  .card .face{font-size:44px;font-weight:900;opacity:0;transition:opacity .15s ease}
  .card.revealed .face{opacity:1}
  .card .label{position:absolute;bottom:10px;left:12px;right:12px;text-align:center;font-size:14px;color:#ddd;opacity:.85}
  .card .cover{
     position:absolute;inset:0;border-radius:16px;
     background: radial-gradient(120% 120% at 100% 0%, rgba(255,255,255,.04), transparent 40%),
                 linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,0));
     border:2px solid var(--edge); opacity:.95; display:flex;align-items:center;justify-content:center;
     font-weight:800;font-size:20px;letter-spacing:.06em; z-index:2;
  }
  .card.revealed .cover{display:none}

  .timerbar{height:14px;background:#1a1a1a;border:1px solid #333;border-radius:999px;overflow:hidden}
  .timerfill{height:100%;width:100%;background:linear-gradient(90deg,#4caf50,#8bc34a);transform-origin:left;transform:scaleX(1)}
  .msg{min-height:28px;color:#d8d8d8;margin:8px 2px 2px}
  .muted{color:#a1a1a1}
  .center{text-align:center}
  .small{font-size:12px;color:#a8a8a8}
  .lose{color:#ff6b6b}
  .win{color:#7cf58a}
  .footer{opacity:.7;font-size:12px;margin-top:10px;text-align:center}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#222;border:1px solid #333;color:#9ad896;font-weight:800;font-size:11px;margin-left:6px}
  .mute{background:#1b1b1b;border:1px solid #333;color:#ddd}
</style>
</head>
<body>
<div class="wrap">
  <h1>Two-Card Multiplier <span class="badge">v11</span></h1>

  <div class="panel" id="setupPanel">
    <div class="row">
      <label for="bet">Enter your stake (GEL):</label>
      <input id="bet" type="number" min="1" step="1" value="5" />
      <button class="btn-start" id="startBtn">Start Game</button>
    </div>
    <p class="small muted">Rules: Pick one of two hidden cards every round. It may reveal a multiplier or a <strong class="lose">FALSE</strong> card (you lose). Each round lasts 5s. There are 6 rounds. You can cash out anytime.</p>
  </div>

  <div class="panel" id="gamePanel" style="display:none">
    <div class="hud">
      <div class="stat"><span class="k">Stake</span><span class="v" id="stakeV">â€”</span></div>
      <div class="stat"><span class="k">Current</span><span class="v" id="currentV">â€”</span></div>
      <div class="stat"><span class="k">Round</span><span class="v" id="roundV">â€”</span></div>
      <div class="stat"><span class="k">Timer</span><span class="v" id="timerV">5.0s</span></div>
      <button id="muteBtn" class="mute">ðŸ”Š</button>
    </div>

    <div class="arena">
      <div class="card red" data-side="left">
        <div class="cover">TAP TO REVEAL</div>
        <div class="face"></div>
        <div class="label">Red Card</div>
      </div>
      <div class="card blue" data-side="right">
        <div class="cover">TAP TO REVEAL</div>
        <div class="face"></div>
        <div class="label">Blue Card</div>
      </div>
    </div>

    <div class="timerbar"><div class="timerfill" id="timerFill"></div></div>
    <div class="msg" id="msg">&nbsp;</div>
    <button id="cashOutBtn" class="btn-cash">CASH OUT</button>
    <div class="footer">Adjust odds in code: <span class="muted">MULTIPLIERS, TRAP_RATE, ROUND_TIME, TOTAL_ROUNDS</span></div>
  </div>

  <div class="panel" id="endPanel" style="display:none">
    <div class="center">
      <h2 id="endTitle">Game over</h2>
      <p id="endBody" class="muted"></p>
      <button class="btn-start" id="restartBtn">Play Again</button>
    </div>
  </div>
</div>

<script>
(() => {
  // ======= Tweakables =======
  const MULTIPLIERS = [1.5, 2];
  const TRAP_RATE   = 0.28;
  const DOUBLE_SAFE_RATE = 0.20;
  const ROUND_TIME = 5.0;
  const TOTAL_ROUNDS = 6;

  // ======= State =======
  let stake = 0, current = 0, round = 0;
  let picked = false, timerId = null;
  let board = [null,null];
  let roundOutcome = null; // "win" | "trap" | null
  let ac = null, masterGain = null, musicInt = null, muted = false;

  // ======= DOM =======
  const $ = id => document.getElementById(id);
  const setupPanel = $('setupPanel'), gamePanel = $('gamePanel'), endPanel = $('endPanel');
  const stakeV = $('stakeV'), currentV = $('currentV'), roundV = $('roundV'), timerV = $('timerV'), timerFill = $('timerFill'), msg = $('msg');
  const cards = [...document.querySelectorAll('.card')];
  const cashBtn = $('cashOutBtn'), muteBtn = $('muteBtn');

  $('startBtn').addEventListener('click', startGame);
  cashBtn.addEventListener('click', ()=>{ if (cashBtn.classList.contains('btn-disabled')) return; sfx('cash'); cashOut(); });
  $('restartBtn').addEventListener('click', () => {
    setupPanel.style.display='block'; gamePanel.style.display='none'; endPanel.style.display='none'; msg.textContent='';
  });
  cards.forEach(c => c.addEventListener('click', () => (!timerId||picked)?null:reveal(c)));
  muteBtn.addEventListener('click', toggleMute);

  // ======= Audio (WebAudio, lightweight) =======
  function ensureAudio(){
    if (ac) return;
    ac = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = ac.createGain(); masterGain.gain.value = 0.5; masterGain.connect(ac.destination);
  }
  function sfx(type){
    if (!ac || muted) return;
    const now = ac.currentTime;
    if (type==='click'){
      const o = ac.createOscillator(); const g = ac.createGain();
      o.type='square'; o.frequency.setValueAtTime(600, now);
      g.gain.setValueAtTime(0.25, now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.08);
      o.connect(g).connect(masterGain); o.start(now); o.stop(now+0.1);
    } else if (type==='win'){
      const o = ac.createOscillator(); const g = ac.createGain();
      o.type='triangle'; o.frequency.setValueAtTime(440, now);
      o.frequency.exponentialRampToValueAtTime(880, now+0.25);
      g.gain.setValueAtTime(0.001, now); g.gain.exponentialRampToValueAtTime(0.4, now+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, now+0.35);
      o.connect(g).connect(masterGain); o.start(now); o.stop(now+0.4);
    } else if (type==='crash'){ // noise burst
      const buffer = ac.createBuffer(1, ac.sampleRate*0.3, ac.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<data.length;i++) data[i] = (Math.random()*2-1)*Math.pow(1-i/data.length, 1.5);
      const s = ac.createBufferSource(); s.buffer = buffer;
      const g = ac.createGain(); g.gain.setValueAtTime(0.45, now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.3);
      const lp = ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=2200;
      s.connect(lp).connect(g).connect(masterGain); s.start(now);
    } else if (type==='cash'){
      const o = ac.createOscillator(); const g = ac.createGain();
      o.type='sine'; o.frequency.setValueAtTime(880, now);
      g.gain.setValueAtTime(0.2, now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.12);
      o.connect(g).connect(masterGain); o.start(now); o.stop(now+0.13);
    }
  }
  function startMusic(){
    if (musicInt || muted) return;
    const seq = [220, 220, 277, 220, 330, 220, 196, 220]; // simple loop
    let i = 0;
    musicInt = setInterval(()=>{
      if (muted || !ac) return;
      const o = ac.createOscillator(); const g = ac.createGain();
      o.type='sine'; o.frequency.value = seq[i%seq.length];
      g.gain.value = 0.06; o.connect(g).connect(masterGain);
      o.start(); o.stop(ac.currentTime+0.18);
      i++;
    }, 220);
  }
  function stopMusic(){ if (musicInt){ clearInterval(musicInt); musicInt=null; } }
  function toggleMute(){
    muted = !muted;
    muteBtn.textContent = muted ? 'ðŸ”‡' : 'ðŸ”Š';
    if (muted) stopMusic(); else startMusic();
  }

  // ======= Helpers =======
  const fmt = n => (Math.round(n*100)/100).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  const rand = arr => arr[Math.floor(Math.random()*arr.length)];
  function chooseBoard(){
    board=[null,null];
    const doTrap = Math.random()<TRAP_RATE;
    const bothSafe = !doTrap && (Math.random()<DOUBLE_SAFE_RATE);
    if (bothSafe){
      board[0]={type:'mult',x:rand(MULTIPLIERS)}; board[1]={type:'mult',x:rand(MULTIPLIERS)};
    } else if (doTrap){
      const s = Math.random()<0.5?0:1;
      board[s]={type:'trap'}; board[1-s]={type:'mult',x:rand(MULTIPLIERS)};
    } else {
      board[0]={type:'mult',x:rand(MULTIPLIERS)}; board[1]={type:'mult',x:rand(MULTIPLIERS)};
    }
  }
  function updateHUD(){ stakeV.textContent=fmt(stake)+' GEL'; currentV.textContent=fmt(current)+' GEL'; roundV.textContent=`${round} / ${TOTAL_ROUNDS}`; }
  function resetCards(){
    cards.forEach(c=>{ c.classList.remove('revealed','success','trap'); c.querySelector('.face').textContent=''; });
    cashBtn.classList.remove('btn-disabled'); // enable cash out at round start
    roundOutcome = null;
  }

  function reveal(cardEl){
    if (picked) return;
    picked = true;
    sfx('click');
    const side = cardEl.dataset.side==='left'?0:1, otherSide = 1-side;
    const content = board[side];
    cardEl.classList.add('revealed');

    // Reveal other card for transparency
    const other = cards[otherSide];
    other.classList.add('revealed');
    const oc = board[otherSide];
    other.querySelector('.face').textContent = (oc.type==='trap')?'Ã—':`${oc.x}Ã—`;

    if (content.type==='trap'){
      // FAIL -> full red, disable cashout until round ends, play crash
      cardEl.querySelector('.face').textContent = 'Ã—';
      cardEl.classList.add('trap');
      cashBtn.classList.add('btn-disabled');   // 50% opacity + unclickable
      msg.innerHTML = `FALSE card selected. Round will end, then the game ends.`;
      roundOutcome = 'trap';
      current = 0; updateHUD();
      sfx('crash');
      return; // let the timer end the round
    } else {
      // WIN -> full green, play win; keep round running
      cardEl.querySelector('.face').textContent = `${content.x}Ã—`;
      current = +(current * content.x).toFixed(2);
      cardEl.classList.add('success');
      msg.innerHTML = `Multiplier hit: <span class="win">${content.x}Ã—</span>. Round continuesâ€¦`;
      roundOutcome = 'win';
      updateHUD();
      sfx('win');
    }
  }

  function startRound(){
    round++; if (round > TOTAL_ROUNDS){ endGame(false); return; }
    picked=false; chooseBoard(); resetCards();
    msg.textContent='Pick a card!'; updateHUD();
    startTimer(ROUND_TIME, ()=>{
      // End-of-round behavior:
      if (!picked){
        msg.innerHTML='<span class="muted">No pick made â€” auto cash out.</span>';
        sfx('cash');
        cashOut();
        return;
      }
      if (roundOutcome === 'trap'){
        endGame(true);                    // chosen FAIL â†’ end after timer
      } else {
        setTimeout(()=> startRound(), 400); // chosen WIN â†’ move to next round
      }
    });
  }

  function startGame(){
    ensureAudio(); startMusic();
    const val = Number(document.getElementById('bet').value);
    if (!Number.isFinite(val)||val<=0){ alert('Enter a valid positive amount.'); return; }
    stake=current=Math.floor(val*100)/100; round=0; updateHUD();
    setupPanel.style.display='none'; endPanel.style.display='none'; gamePanel.style.display='block';
    startRound();
  }

  function cashOut(){ stopTimer(); stopMusic(); endGame(false,true); }

  function endGame(lost=false,cashed=false){
    stopTimer(); stopMusic(); gamePanel.style.display='none'; endPanel.style.display='block';
    const t=document.getElementById('endTitle'), b=document.getElementById('endBody');
    if(lost){ t.textContent='You hit a FALSE card.'; b.innerHTML=`Final total: <strong class="lose">${fmt(current)} GEL</strong> from a stake of ${fmt(stake)} GEL.`; }
    else if(cashed){ t.textContent='You cashed out!'; b.innerHTML=`You leave with <strong class="win">${fmt(current)} GEL</strong> from a stake of ${fmt(stake)} GEL at round ${round}/${TOTAL_ROUNDS}.`; }
    else { t.textContent='Rounds complete!'; b.innerHTML=`Final total after ${TOTAL_ROUNDS} rounds: <strong class="win">${fmt(current)} GEL</strong> (stake was ${fmt(stake)} GEL).`; }
  }

  // ======= Timer =======
  function startTimer(seconds,onEnd){
    stopTimer(); const t0=performance.now();
    timerFill.style.transform='scaleX(1)';
    function tick(){
      const left=Math.max(0, seconds - (performance.now()-t0)/1000);
      timerV.textContent=`${left.toFixed(1)}s`;
      timerFill.style.transform=`scaleX(${Math.max(0,left/seconds)})`;
      if(left<=0.01){ stopTimer(); if(typeof onEnd==='function') onEnd(true); }
    }
    timerId=setInterval(tick,100); tick();
  }
  function stopTimer(){ if(timerId){ clearInterval(timerId); timerId=null; } }
})();
</script>
</body>
</html>
